<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockly C++</title>
    <link rel="stylesheet" href="https://unpkg.com/minecraft-framework-css@1.1.9/css/main.css">
    <script src="https://unpkg.com/minecraft-framework-css@1.1.9/css/assets/script.js"></script>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <style>
        .container {
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .workspace-controls-container {
            display: flex;
            flex-direction: row;
            height: 100%;
        }

        #blocklyDiv {
            height: 100%;
            width: 100%;
            border: 2px solid #ccc;
        }

        #controls {
            height: 100%;
            width: 30%;
            margin-left: 20px;
            overflow-y: auto;
        }

        button, input[type="file"] {
            display: block;
            margin: 10px 0;
        }

        input[type="file"] {
            padding: 8px;
        }
    </style>
</head>
<body>
    <div class="container" cursor="arrow">
        <h1 class="dialogue-box">Blockly C++ Editor By Ericbob</h1>
        <div class="workspace-controls-container">
            <div id="blocklyDiv" class="dialogue-box"></div>
            <div id="controls">
                <button class="button-java" onclick="saveWorkspaceAsXML()">Download XML</button>
                <label for="uploadXML">Upload a file [XML (.xml)]:</label>
                <input class="input-text" type="file" id="uploadXML" accept=".xml" onchange="handleXMLUpload(event)">
                <button class="button-java" onclick="saveCodeAsCPP()">Download C++</button>
                <label for="uploadCPP">Upload a file [C++ (.cpp)]:</label>
                <input class="input-text" type="file" id="uploadCPP" accept=".cpp" onchange="loadCodeFromCPP(event)">
            </div>
        </div>
    </div>

    <script>
        var workspace = Blockly.inject('blocklyDiv', {
            toolbox: `
                <xml>
                        <category name="自定義變數" colour="60">
                            <block type="variable_declaration"></block>
                            <block type="variable_assignment"></block>
                            <block type="variable_get"></block>
                        </category>
                        <category name="自定義函式" colour="290">
                            <block type="basic_function_definition"></block>
                            <block type="function_call"></block>
                        </category>
                        <category name="邏輯運算子" colour="210">
                            <block type="or_and_xor"></block>
                            <block type="logic_operators"></block>
                            <block type="logic_not"></block>
                        </category>
                        <category name="數學與運算" colour="230">
                            <block type="math_caculacte"></block>
                            <block type="math_sqrt"></block>
                            <block type="math_abs"></block>
                            <block type="math_sine"></block>
                            <block type="math_cosine"></block>
                            <block type="math_tangent"></block>
                            <block type="math_ceil"></block>
                            <block type="math_floor"></block>
                            <block type="math_random"></block>
                        </category>
                        <category name="文本操作" colour="160">
                            <block type="comment_block"></block>
                        </category>
                        <category name="條件與迴圈" colour="260">
                            <block type="controls_if"></block>
                            <block type="switch_block">
                                <statement name="DO">
                                    <block type="default_block">
                                        <statement name="DO">
                                            <block type="break_block"></block>
                                        </staement>
                                    </block>
                                </staement>
                            </block>
                            <block type="case_block">
                                <statement name="DO">
                                    <block type="break_block"></block>
                                </staement>
                            </block>
                            <block type="for_block"></block>
                            <block type="while_block"></block>
                            <block type="break_block"></block>
                            <block type="continue_block"></block>
                            <block type="return_block"></block>
                        </category>
                        <category name="輸入與輸出" colour="120">
                            <block type="cin_block"></block>
                            <block type="cout_block"></block>
                            <block type="scanf_block"></block>
                            <block type="printf_block"></block>
                            <block type="boost_ios_sync"></block>
                            <block type="boost_cin_tie"></block>
                            <block type="boost_cout_tie"></block>
                        </category>
                        <sep></sep>
                        <category name="主程式框架" colour="0">
                            <block type="include_bits/stdc++.h">
                                <next>
                                    <block type="main_block"></block>
                                </next>
                            </block>
                        </category>
                        <sep></sep>
                        <category name="測試 Block" colour="290">
                        </category>
                </xml>
            `
        });

        Blockly.defineBlocksWithJsonArray([
            {//cin
                "type": "cin_block",
                "message0": "cin >> %1",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "VARIABLES",
                    "check": "Array" // 用於存放多個輸入變量
                    }
                ],
                "inputsInline": true,
                "output": "Void",
                "colour": 120,
                "tooltip": "Inputs multiple values from the console.",
                "helpUrl": ""
            },
            {//cout
                "type": "cout_block",
                "message0": "cout << %1 %2",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "VALUE",
                    "check": "Array"
                    },
                    {
                    "type": "field_dropdown",
                    "name": "ENDL_OPTION",
                    "options": [
                        ["no endl", ""],
                        ["<< endl", "endl"]
                    ]
                    }
                ],
                "inputsInline": true,
                "output": "Void",
                "colour": 120,
                "tooltip": "Outputs value to the console.",
                "helpUrl": ""
                },
            {//if
                "type": "controls_if",
                "message0": "if %1",
                "args0": [
                    {
                        "type": "input_value",
                        "name": "IF0",
                        "check": "Boolean"
                    }
                ],
                "message1": "do %1",
                "args1": [
                    {
                        "type": "input_statement",
                        "name": "do0"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 260,
                "tooltip": "如果條件為真，執行",
                "helpUrl": "",
                "mutator": "controls_if_mutator"
            },
            {//for
                "type": "for_block",
                "message0": "for %1 = %2 ; %3 ; %4   %5 ",
                "args0": [
                    {
                        "type": "field_variable",
                        "name": "VAR",
                        "variable": "i"
                    },
                    {
                        "type": "input_value",
                        "name": "INIT",
                        "check": "Number"
                    },
                    {
                        "type": "input_value",
                        "name": "CONDITION",
                        "check": "Boolean"
                    },
                    {
                        "type": "input_value",
                        "name": "INCREMENT",
                        "check": "Number"
                    },
                    {
                        "type": "input_statement",
                        "name": "DO"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "inputsInline": true,
                "colour": 260,
                "tooltip": "重複執行直到條件為假",
                "helpUrl": ""
            },
            {//while
                "type": "while_block",
                "message0": "while %1  %2 ",
                "args0": [
                    {
                        "type": "input_value",
                        "name": "CONDITION",
                        "check": "Boolean"
                    },
                    {
                        "type": "input_statement",
                        "name": "DO"
                    }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 260,
                "tooltip": "重複執行直到條件為假",
                "helpUrl": ""
            },
            {//int mian()
                "type": "main_block",
                "message0": "int main() %1 %2 return %3",
                "args0": [
                {
                    "type": "input_dummy"
                },
                {
                    "type": "input_statement",
                    "name": "DO"
                },
                {
                    "type": "input_value",
                    "name": "RETURN_VALUE",
                    "check": "Number",
                    "default": "0"
                }
                ],
                "colour": 120,
                "previousStatement": null,
                "tooltip": "主函式，接受命令行參數",
                "helpUrl": ""
            },
            {//switch
                "type": "switch_block",
                "message0": "switch %1 %2 %3",
                "args0": [
                {
                    "type": "input_value",
                    "name": "SWITCH_VALUE"
                },
                {
                    "type": "input_statement",
                    "name": "DO"
                },
                {
                    "type": "input_dummy"
                }
                ],
                "colour": 260,
                "previousStatement": null,
                "nextStatement": null,
                "tooltip": "Switch 語句",
                "helpUrl": ""
            },
            {//case
                "type": "case_block",
                "message0": "case %1 %2",
                "args0": [
                {
                    "type": "input_value",
                    "name": "CASE_VALUE"
                },
                {
                    "type": "input_statement",
                    "name": "DO"
                }
                ],
                "previousStatement": null,
                "nextStatement": null,
                "colour": 260,
                "tooltip": "Case 語句",
                "helpUrl": ""
            },
            {//default
                "type": "default_block",
                "message0": "default %1",
                "args0": [
                {
                    "type": "input_statement",
                    "name": "DO"
                }
                ],
                "previousStatement": null,
                "colour": 260,
                "tooltip": "Default 語句",
                "helpUrl": ""
            },
            {//break
                "type": "break_block",
                "message0": "break",
                "colour": 260,
                "previousStatement": null,
                "nextStatement": null,
                "tooltip": "退出當前的循環或 switch 語句",
                "helpUrl": ""
            },
            {//continue
                "type": "continue_block",
                "message0": "continue",
                "colour": 260,
                "previousStatement": null,
                "nextStatement": null,
                "tooltip": "跳過當前迴圈的剩餘部分，直接進入下一次迴圈",
                "helpUrl": ""
            },
            {//return
                "type": "return_block",
                "message0": "return %1",
                "args0": [
                {
                    "type": "input_value",
                    "name": "RETURN_VALUE",
                    "check": "Number"
                }
                ],
                "colour": 260,
                "previousStatement": null,
                "tooltip": "從函式返回值",
                "helpUrl": ""
            },
            {//def function
                "type": "basic_function_definition",
                "message0": "function %1 %2 %3 %4 %5",
                "args0": [
                {
                    "type": "field_variable",
                    "name": "FUNC_NAME",
                    "variable": "myFunction"
                },
                {
                    "type": "field_dropdown",
                    "name": "RETURN_TYPE",
                    "options": [
                    ["void", "void"],
                    ["int", "int"],
                    ["float", "float"],
                    ["double", "double"],
                    ["char", "char"],
                    ["string", "std::string"]
                    ]
                },
                {
                    "type": "input_dummy"
                },
                {
                    "type": "input_statement",
                    "name": "DO"
                },
                {
                    "type": "input_dummy"
                }
                ],
                "colour": 290,
                "tooltip": "定義一個基本的 C++ 函數",
                "helpUrl": ""
            },
            {//cll function
                "type": "function_call",
                "message0": "%1",
                "args0": [
                {
                    "type": "field_variable",
                    "name": "FUNC_NAME",
                    "variable": "myFunction"
                }
                ],
                "colour": 290,
                "previousStatement": null,
                "nextStatement": null,
                "tooltip": "調用一個函數",
                "helpUrl": ""
            },
            {//comment
                "type": "comment_block",
                "message0": "// %1",
                "args0": [
                {
                    "type": "field_input",
                    "name": "COMMENT",
                    "text": "註解"
                }
                ],
                "colour": 160,
                "previousStatement": null,
                "nextStatement": null,
                "tooltip": "添加註解",
                "helpUrl": ""
            },
            {//def variable
                "type": "variable_declaration",
                "message0": "declare %1 %2 = %3",
                "args0": [
                {
                    "type": "field_dropdown",
                    "name": "TYPE",
                    "options": [
                    ["int", "int"],
                    ["float", "float"],
                    ["double", "double"],
                    ["char", "char"],
                    ["string", "std::string"]
                    ]
                },
                {
                    "type": "field_variable",
                    "name": "VAR_NAME",
                    "variable": "myVar"
                },
                {
                    "type": "input_value",
                    "name": "VALUE"
                }
                ],
                "colour": 60,
                "tooltip": "宣告一個變數",
                "helpUrl": ""
            },
            {//variable equals
                "type": "variable_assignment",
                "message0": "%1 = %2",
                "args0": [
                {
                    "type": "field_variable",
                    "name": "VAR_NAME",
                    "variable": "myVar"
                },
                {
                    "type": "input_value",
                    "name": "VALUE"
                }
                ],
                "colour": 60,
                "tooltip": "賦予變數新的值或算式",
                "helpUrl": ""
            },
            {//get variable vaule
                "type": "variable_get",
                "message0": "%1",
                "args0": [
                {
                    "type": "field_variable",
                    "name": "VAR_NAME",
                    "variable": "myVar"
                }
                ],
                "output": null,
                "colour": 60,
                "tooltip": "獲取變數的值",
                "helpUrl": ""
            },
            {//#include <bits/stdc++.h>
                "type": "include_bits/stdc++.h",
                "message0": "#include <bits/stdc++.h>",
                "nextStatement": null,
                "colour": 0,
                "tooltip": "Include all",
                "helpUrl": ""
            },
            {//or and xor
                "type": "or_and_xor",
                "message0": "%1 %2 %3",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "A"
                    },
                    {
                    "type": "field_dropdown",
                    "name": "OPERATOR",
                    "options": [
                        ["&&", "AND"],
                        ["||", "OR"],
                        ["^", "XOR"]
                    ]
                    },
                    {
                    "type": "input_value",
                    "name": "B"
                    }
                ],
                "output": "Boolean",
                "colour": 210,
                "inputsInline": true,
                "tooltip": "or and xor",
                "helpUrl": ""
            },
            {//logic operators
                "type": "logic_operators",
                "message0": "%1 %2 %3",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "A"
                    },
                    {
                    "type": "field_dropdown",
                    "name": "OPERATOR",
                    "options": [
                        ["==", "EQUAL"],
                        ["!=", "NOT_EQUAL"],
                        [">", "GREATER"],
                        ["<", "LESS"],
                        [">=", "GREATER_EQUAL"],
                        ["<=", "LESS_EQUAL"]
                    ]
                    },
                    {
                    "type": "input_value",
                    "name": "B"
                    }
                ],
                "output": "Boolean",
                "colour": 210,
                "inputsInline": true,
                "tooltip": "Performs selected logical or comparison operation.",
                "helpUrl": ""
            },
            {//logic not
                "type": "logic_not",
                "message0": "!%1",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "A"
                    }
                ],
                "output": "Boolean",
                "colour": 210,
                "tooltip": "Returns true if the condition is false.",
                "helpUrl": ""
            },
            {//math caculacte
                "type": "math_caculacte",
                "message0": "%1  %2  %3",
                "args0": [
                    {
                        "type": "input_value",
                         "name": "A"
                    },
                    {
                    "type": "field_dropdown",
                    "name": "OPERATOR",
                    "options": [
                        ["+", "ADD"],
                        ["-", "SUBTRACT"],
                        ["*", "MUTIPLY"],
                        ["/", "DEVIDE"],
                        ["%", "MODULO"],
                        ["^", "POWER"]
                    ]
                    },
                    {
                        "type": "input_value",
                         "name": "B"
                    }
                ],
                "output": "Number",
                "colour": 230,
                "inputsInline": true,
                "tooltip": "運算",
                "helpUrl": ""
            },
            {//sqrt
                "type": "math_sqrt",
                "message0": "sqrt(%1)",
                "args0": [
                    {"type": "input_value", "name": "X"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "平方根運算",
                "helpUrl": ""
            },
            {//abs
                "type": "math_abs",
                "message0": "abs(%1)",
                "args0": [
                    {"type": "input_value", "name": "A"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "絕對值運算",
                "helpUrl": ""
            },
            {//sin
                "type": "math_sine",
                "message0": "sin(%1)",
                "args0": [
                    {"type": "input_value", "name": "ANGLE"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "正弦運算",
                "helpUrl": ""
            },
            {//cos
                "type": "math_cosine",
                "message0": "cos(%1)",
                "args0": [
                    {"type": "input_value", "name": "ANGLE"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "余弦運算",
                "helpUrl": ""
            },
            {//tan
                "type": "math_tangent",
                "message0": "tan(%1)",
                "args0": [
                    {"type": "input_value", "name": "ANGLE"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "正切運算",
                "helpUrl": ""
            },
            {//ceil
                "type": "math_ceil",
                "message0": "ceil(%1)",
                "args0": [
                    {"type": "input_value", "name": "X"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "向上取整",
                "helpUrl": ""
            },
            {//floor
                "type": "math_floor",
                "message0": "floor(%1)",
                "args0": [
                    {"type": "input_value", "name": "X"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "向下取整",
                "helpUrl": ""
            },
            {//random
                "type": "math_random",
                "message0": "rand() % %1",
                "args0": [
                    {"type": "input_value", "name": "RANGE"}
                ],
                "output": "Number",
                "colour": 230,
                "tooltip": "隨機數生成",
                "helpUrl": ""
            },
            {//ios sync
                "type": "boost_ios_sync",
                "message0": "ios::sync_with_stdio(0); %1",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "VALUE"
                    }
                ],
                "output": "null",
                "colour": 160,
                "tooltip": "禁用同步以提高輸入輸出效率",
                "helpUrl": ""
            },
            {//cin tie
                "type": "boost_cin_tie",
                "message0": "cin.tie(0); %1",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "VALUE"
                    }
                ],
                "output": "null",
                "colour": 160,
                "tooltip": "解除 cin 和 cout 的綁定",
                "helpUrl": ""
            },
            {//cout tie
                "type": "boost_cout_tie",
                "message0": "cout.tie(0); %1",
                "args0": [
                    {
                    "type": "input_value",
                    "name": "VALUE"
                    }
                ],
                "output": "null",
                "colour": 160,
                "tooltip": "解除 cout 和 cin 的綁定",
                "helpUrl": ""
            },
            {//scanf
                "type": "scanf_block",
                "message0": "scanf(%1, %2)",
                "args0": [
                    {
                        "type": "input_value",
                        "name": "FORMAT"
                    },
                    {
                        "type": "input_value",
                        "name": "VARIABLE"
                    }
                ],
                "output": "null",
                "colour": 120,
                "tooltip": "使用 scanf 讀取輸入",
                "helpUrl": ""
            },
            {//printf
                "type": "printf_block",
                "message0": "printf(%1, %2)",
                "args0": [
                    {
                        "type": "input_value",
                        "name": "FORMAT"
                    },
                    {
                        "type": "input_value",
                        "name": "VARIABLE"
                    }
                ],
                "output": "null",
                "colour": 120,
                "tooltip": "使用 printf 輸出格式化的字串",
                "helpUrl": ""
            }
        ]);

        Blockly.Cpp['boost_scanf'] = function(block) {
            var format = Blockly.Cpp.valueToCode(block, 'FORMAT', Blockly.Cpp.ORDER_ATOMIC);
            return 'scanf("%s", ' + format + ');\n';
        };

        Blockly.Cpp['boost_printf'] = function(block) {
            var format = Blockly.Cpp.valueToCode(block, 'FORMAT', Blockly.Cpp.ORDER_ATOMIC);
            return 'printf("%s", ' + format + ');\n';
        };

        Blockly.Cpp['boost_ios_sync'] = function(block) {
            return 'std::ios::sync_with_stdio(0);\n';
        };

        Blockly.Cpp['boost_cin_tie'] = function(block) {
            return 'std::cin.tie(0);\n';
        };

        Blockly.Cpp['boost_cout_tie'] = function(block) {
            return 'std::cout.tie(0);\n';
        };

        Blockly.cpp['include_bits/stdc++.h'] = function(block) {
            return '#include <bits/stdc++.h>\n';
        };

        Blockly.Cpp['variable_declaration'] = function(block) {
            var type = block.getFieldValue('TYPE');
            var varName = Blockly.Cpp.variableDB_.getName(block.getFieldValue('VAR_NAME'), Blockly.Variables.NAME_TYPE);
            var value = Blockly.Cpp.valueToCode(block, 'VALUE', Blockly.Cpp.ORDER_ASSIGNMENT) || '0'; // 預設值
            return `${type} ${varName} = ${value};\n`;
        };

        Blockly.Cpp['variable_assignment'] = function(block) {
            var varName = Blockly.Cpp.variableDB_.getName(block.getFieldValue('VAR_NAME'), Blockly.Variables.NAME_TYPE);
            var value = Blockly.Cpp.valueToCode(block, 'VALUE', Blockly.Cpp.ORDER_ASSIGNMENT) || '0';
            return `${varName} = ${value};\n`;
        };

        Blockly.Cpp['variable_get'] = function(block) {
            var varName = Blockly.Cpp.variableDB_.getName(block.getFieldValue('VAR_NAME'), Blockly.Variables.NAME_TYPE);
            return varName;
        };

        Blockly.Cpp['comment_block'] = function(block) {
            var comment = block.getFieldValue('COMMENT');
            return `// ${comment}\n`;
        };

        Blockly.Cpp['function_call'] = function(block) {
            var funcName = Blockly.Cpp.variableDB_.getName(block.getFieldValue('FUNC_NAME'), Blockly.Variables.NAME_TYPE);
            return `${funcName}();\n`;
        };

        Blockly.Cpp['basic_function_definition'] = function(block) {
            var funcName = Blockly.Cpp.variableDB_.getName(block.getFieldValue('FUNC_NAME'), Blockly.Variables.NAME_TYPE);
            var returnType = block.getFieldValue('RETURN_TYPE');
            var body = Blockly.Cpp.statementToCode(block, 'DO') || '// 函數執行的代碼\n';

            if (returnType === 'void') {
                return `${returnType} ${funcName}() {\n${body}}\n`;
            } else {
                return `${returnType} ${funcName}() {\n${body} return 0;\n}\n`;
            }
        };

        Blockly.Cpp['break_block'] = function() {
            return 'break;\n';
        };

        Blockly.Cpp['continue_block'] = function() {
            return 'continue;\n';
        };

        Blockly.Cpp['return_block'] = function(block) {
            var returnValue = Blockly.Cpp.valueToCode(block, 'RETURN_VALUE', Blockly.Cpp.ORDER_NONE) || '0';
            return `return ${returnValue};\n`;
        };

        Blockly.Cpp['switch_block'] = function(block) {
            var switchValue = Blockly.Cpp.valueToCode(block, 'SWITCH_VALUE', Blockly.Cpp.ORDER_NONE) || '0';
            var caseStatements = Blockly.Cpp.statementToCode(block, 'DO');
            var code = `switch (${switchValue}) {\n${caseStatements}}\n`;
            return code;
        };

        Blockly.Cpp['case_block'] = function(block) {
            var caseValue = Blockly.Cpp.valueToCode(block, 'CASE_VALUE', Blockly.Cpp.ORDER_NONE) || '0';
            var statements_do = Blockly.Cpp.statementToCode(block, 'DO');
            var code = `case ${caseValue}:\n${statements_do}\n`;
            return code;
        };

        Blockly.Cpp['default_block'] = function(block) {
            var statements_do = Blockly.Cpp.statementToCode(block, 'DO');
            var code = `default:\n${statements_do}\n`;
            return code;
        };

        Blockly.Cpp['main_block'] = function(block) {
            var statements_body = Blockly.Cpp.statementToCode(block, 'BODY');
            return `int main() {\n${statements_body}return 0;\n}\n`;
        };

        Blockly.Cpp['controls_if'] = function(block) {
            var n = 0;
            var code = '';
            do {
                var conditionCode = Blockly.Cpp.valueToCode(block, 'IF' + n, Blockly.Cpp.ORDER_NONE) || 'false';
                var branchCode = Blockly.Cpp.statementToCode(block, 'DO' + n);
                code += (n === 0 ? 'if (' : ' else if (') + conditionCode + ') {\n' + branchCode + '}\n';
                ++n;
            } while (block.getInput('IF' + n));

            if (block.getInput('ELSE')) {
                var elseBranch = Blockly.Cpp.statementToCode(block, 'ELSE');
                code += ' else {\n' + elseBranch + '}\n';
            }
            return code;
        };

        Blockly.Cpp['for_block'] = function(block) {
            var varName = Blockly.Cpp.variableDB_.getName(block.getFieldValue('VAR'), Blockly.Variables.NAME_TYPE);
            var init = Blockly.Cpp.valueToCode(block, 'INIT', Blockly.Cpp.ORDER_NONE);
            var condition = Blockly.Cpp.valueToCode(block, 'CONDITION', Blockly.Cpp.ORDER_NONE) || 'false';
            var increment = Blockly.Cpp.valueToCode(block, 'INCREMENT', Blockly.Cpp.ORDER_NONE);
            var branch = Blockly.Cpp.statementToCode(block, 'DO');
            return `for (int ${varName} = ${init}; ${condition}; ${increment}) {\n${branch}}\n`;
        };

        Blockly.Cpp['while_block'] = function(block) {
            var condition = Blockly.Cpp.valueToCode(block, 'CONDITION', Blockly.Cpp.ORDER_NONE) || 'false';
            var branch = Blockly.Cpp.statementToCode(block, 'DO');
            return `while (${condition}) {\n${branch}}\n`;
        };

        Blockly.Cpp['cin_block'] = function(block) {
            var value_var = Blockly.Cpp.valueToCode(block, 'VAR', Blockly.Cpp.ORDER_ATOMIC) || 'variable';
            var code = 'std::cin >> ' + value_var + ';\n';
            return code;
        };

        Blockly.Cpp['cout_block'] = function(block) {
            var argument = Blockly.Cpp.valueToCode(block, 'TEXT', Blockly.Cpp.ORDER_NONE) || '""';
            var code = 'std::cout << ' + argument + ' << std::endl;\n';
            return code;
        };

        function saveWorkspaceAsXML() {
            var xml = Blockly.Xml.workspaceToDom(workspace);
            var xmlText = Blockly.Xml.domToPrettyText(xml);
            var blob = new Blob([xmlText], { type: 'text/xml' });
            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'workspace.xml';
            link.click();
        }

        function handleXMLUpload(event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(event) {
                    var xml_text = event.target.result;
                    var xml = Blockly.Xml.textToDom(xml_text);
                    Blockly.Xml.domToWorkspace(xml, workspace);
                };
                reader.readAsText(file);
            }
        }

        function saveCodeAsCPP() {
            var code = Blockly.Cpp.workspaceToCode(workspace);
            var blob = new Blob([code], {type: "text/plain"});
            var link = document.createElement("a");
            link.href = window.URL.createObjectURL(blob);
            link.download = "code.cpp";
            link.click();
        }

        function loadCodeFromCPP(event) {
            var file = event.target.files[0];
            if (file) {
                var reader = new FileReader();
                reader.onload = function(event) {
                    var code = event.target.result;
                    // 這裡可以解析 C++ 代碼並將其轉換回 Blockly 積木
                };
                reader.readAsText(file);
            }
        }
    </script>
</body>
</html>
